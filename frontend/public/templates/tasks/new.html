<!doctype html> 
<html> 
<head><meta charset="utf-8"><title>Nueva Task</title> 
<style>body{font-family:Arial;max-width:700px;margin:20px auto;padding:0 
12px}input,textarea,select{width:100%;padding:8px;margin-top:6px;border:1px solid 
#ccc;border-radius:6px}</style> 
</head> 
<body> 
<h1>Crear Task</h1> 
<form id="form"> 
<label>Título<input name="title" required></label> 
<label>Descripción<textarea name="description" rows="4"></textarea></label> 
<label>Prioridad<select 
name="priority"><option>MEDIUM</option><option>HIGH</option><option>LOW</option></sel
ect></label> 
<label>Team ID<input name="teamId" type="number"></label> 
<label>Tags<input name="tags" placeholder="1,2,3"></label> 
<button style="margin-top:12px">Crear Task</button> 
</form> 
 
<div id="msg" style="color:red;margin-top:10px"></div> 
 
<script> 
const USER_ID = 1; 
 
// Prefill automático si viene de una template 
(function prefill(){ 
  const raw = localStorage.getItem("originTemplate"); 
  if(!raw) return; 
 
  const tpl = JSON.parse(raw); 
 
  document.querySelector("[name=title]").value = tpl.name || ""; 
  document.querySelector("[name=description]").value = tpl.description || ""; 
  document.querySelector("[name=priority]").value = tpl.priority || "MEDIUM"; 
  document.querySelector("[name=teamId]").value = tpl.teamId || ""; 
  document.querySelector("[name=tags]").value = tpl.tags ? tpl.tags.join(",") : ""; 
 
  document.getElementById("form").dataset.originTemplateId = tpl.originTemplateId || tpl.id; 
})(); 
 
document.getElementById("form").onsubmit = async (e)=>{ 
  e.preventDefault(); 
  const fd = new FormData(e.target); 
 
  const body = { 
    title: fd.get("title"), 
    description: fd.get("description"), 
    priority: fd.get("priority"), 
    teamId: fd.get("teamId") ? Number(fd.get("teamId")) : undefined, 
    tags: fd.get("tags") ? fd.get("tags").split(",").map(x=>Number(x.trim())) : [], 
    originTemplateId: e.target.dataset.originTemplateId ? 
Number(e.target.dataset.originTemplateId) : undefined 
  }; 
 
  const res = await fetch("/tasks", { 
    method:"POST", 
    headers:{ "Content-Type":"application/json", "x-user-id":USER_ID }, 
    body:JSON.stringify(body) 
  }); 
 
  if(res.ok){ 
    localStorage.removeItem("originTemplate"); 
location.href="/templates"; 
} else { 
const err = await res.json(); 
document.getElementById("msg").innerText = err.error || JSON.stringify(err); 
} 
}; 
</script> 
</body> 
</html>
